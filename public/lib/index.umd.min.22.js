(("undefined"!==typeof self?self:this)["webpackJsonpavueData"]=("undefined"!==typeof self?self:this)["webpackJsonpavueData"]||[]).push([[22],{"13bf":function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("canvas",{ref:"canvas",on:{mousedown:t.mouseDown,mousemove:t.mouseMove,mouseup:t.mouseUp,touchstart:t.touchStart,touchmove:t.touchMove,touchend:t.touchEnd}})},n=[],a=s("2909"),o=(s("a9e3"),s("14d9"),s("d3b7"),s("e6cf"),{props:{width:{type:Number,default:800},height:{type:Number,default:300},lineWidth:{type:Number,default:4},lineColor:{type:String,default:"#000000"},bgColor:{type:String,default:""},isCrop:{type:Boolean,default:!1},isClearBgColor:{type:Boolean,default:!0},format:{type:String,default:"image/png"},quality:{type:Number,default:1}},data:function(){return{hasDrew:!1,resultImg:"",points:[],canvasTxt:null,startX:0,startY:0,isDrawing:!1,sratio:1}},computed:{ratio:function(){return this.height/this.width},stageInfo:function(){return this.$refs.canvas.getBoundingClientRect()},myBg:function(){return this.bgColor?this.bgColor:"rgba(255, 255, 255, 0)"}},watch:{myBg:function(t){this.$refs.canvas.style.background=t}},beforeMount:function(){window.addEventListener("resize",this.$_resizeHandler)},beforeDestroy:function(){window.removeEventListener("resize",this.$_resizeHandler)},mounted:function(){var t=this,e=this.$refs.canvas;e.height=this.height,e.width=this.width,e.style.background=this.myBg,this.$_resizeHandler(),document.onmouseup=function(){t.isDrawing=!1}},methods:{$_resizeHandler:function(){var t=this.$refs.canvas;t.style.width=this.width+"px";var e=parseFloat(window.getComputedStyle(t).width);t.style.height=this.ratio*e+"px",this.canvasTxt=t.getContext("2d"),this.canvasTxt.scale(1*this.sratio,1*this.sratio),this.sratio=e/this.width,this.canvasTxt.scale(1/this.sratio,1/this.sratio)},mouseDown:function(t){t=t||event,t.preventDefault(),this.isDrawing=!0,this.hasDrew=!0;var e={x:t.offsetX,y:t.offsetY};this.drawStart(e)},mouseMove:function(t){if(t=t||event,t.preventDefault(),this.isDrawing){var e={x:t.offsetX,y:t.offsetY};this.drawMove(e)}},mouseUp:function(t){t=t||event,t.preventDefault();var e={x:t.offsetX,y:t.offsetY};this.drawEnd(e),this.isDrawing=!1},touchStart:function(t){if(t=t||event,t.preventDefault(),this.hasDrew=!0,1===t.touches.length){var e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawStart(e)}},touchMove:function(t){if(t=t||event,t.preventDefault(),1===t.touches.length){var e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawMove(e)}},touchEnd:function(t){if(t=t||event,t.preventDefault(),1===t.touches.length){var e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawEnd(e)}},drawStart:function(t){this.startX=t.x,this.startY=t.y,this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.lineWidth=this.lineWidth*this.sratio,this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t)},drawMove:function(t){this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.strokeStyle=this.lineColor,this.canvasTxt.lineWidth=this.lineWidth*this.sratio,this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.startY=t.y,this.startX=t.x,this.points.push(t)},drawEnd:function(t){this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t),this.points.push({x:-1,y:-1})},generate:function(t){var e=this,s=t&&t.format?t.format:this.format,i=t&&t.quality?t.quality:this.quality,n=new Promise((function(t,n){if(e.hasDrew){var o=e.canvasTxt.getImageData(0,0,e.$refs.canvas.width,e.$refs.canvas.height);e.canvasTxt.globalCompositeOperation="destination-over",e.canvasTxt.fillStyle=e.myBg,e.canvasTxt.fillRect(0,0,e.$refs.canvas.width,e.$refs.canvas.height),e.resultImg=e.$refs.canvas.toDataURL(s,i);var r=e.resultImg;if(e.canvasTxt.clearRect(0,0,e.$refs.canvas.width,e.$refs.canvas.height),e.canvasTxt.putImageData(o,0,0),e.canvasTxt.globalCompositeOperation="source-over",e.isCrop){var h,c=e.getCropArea(o.data),l=document.createElement("canvas"),u=l.getContext("2d");l.width=c[2]-c[0],l.height=c[3]-c[1];var f=(h=e.canvasTxt).getImageData.apply(h,Object(a["a"])(c));u.globalCompositeOperation="destination-over",u.putImageData(f,0,0),u.fillStyle=e.myBg,u.fillRect(0,0,l.width,l.height),r=l.toDataURL(s,i),l=null}t(r)}else n("Warning: Not Signned!")}));return n},reset:function(){this.canvasTxt.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.isClearBgColor&&(this.$emit("update:bgColor",""),this.$refs.canvas.style.background="rgba(255, 255, 255, 0)"),this.points=[],this.hasDrew=!1,this.resultImg=""},getCropArea:function(t){for(var e=this.$refs.canvas.width,s=0,i=this.$refs.canvas.height,n=0,a=0;a<this.$refs.canvas.width;a++)for(var o=0;o<this.$refs.canvas.height;o++){var r=4*(a+this.$refs.canvas.width*o);(t[r]>0||t[r+1]>0||t[r+2]||t[r+3]>0)&&(n=Math.max(o,n),s=Math.max(a,s),i=Math.min(o,i),e=Math.min(a,e))}e++,s++,i++,n++;var h=[e,i,s,n];return h}}}),r=o,h=(s("91fa"),s("2877")),c=Object(h["a"])(r,i,n,!1,null,"a1968bcc",null),l=c.exports;l.install=function(t){this.installed||(this.installed=!0,t.component("vueEsign",l))};e["a"]=l},"1d93":function(t,e,s){},"62cc":function(t,e,s){"use strict";s("1d93")},"91fa":function(t,e,s){"use strict";s("f12b")},a84c:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",[e("el-dialog",{staticClass:"JNPF-dialog JNPF-dialog_center sign-dialog",attrs:{title:"请签名",closeOnClickModal:!1,visible:t.signVisible,"append-to-body":"",width:"600px"},on:{"update:visible":function(e){t.signVisible=e}}},[e("div",{staticClass:"sign-main-box"},[e("vue-esign",{ref:"esign",attrs:{height:300,width:560,lineWidth:t.lineWidth}}),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showTip,expression:"showTip"}],staticClass:"tip"},[t._v("使用鼠标在此签名")])],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.handleReset}},[t._v("清空")]),e("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:function(e){return t.handleGenerate()}}},[t._v("确定签名")])],1)])],1)},n=[],a=(s("a9e3"),s("1e85")),o=s("13bf"),r={name:"SignImgDialog",components:{vueEsign:o["a"]},props:{lineWidth:{required:!0,type:Number},isDefault:{required:!0,type:Number},userInfo:{type:Object,default:function(){return{}}}},data:function(){return{signVisible:!1,loading:!1,signImg:"",showTip:!0}},methods:{init:function(){var t=this;this.handleReset(),this.signVisible=!0,this.showTip=!0,this.$nextTick((function(){t.$watch((function(){return t.$refs.esign.hasDrew}),(function(e){t.showTip=!e}))}))},handleReset:function(){var t=this;this.signImg="",this.$nextTick((function(){t.$refs.esign&&t.$refs.esign.reset()}))},handleGenerate:function(){var t=this;this.loading=!0,this.$refs.esign.generate().then((function(e){e&&(t.signImg=e);var s={signImg:t.signImg,isDefault:t.isDefault};Object(a["i"])(s).then((function(e){0==t.isDefault&&(t.$message({message:e.msg,type:"success",duration:1500}),t.userInfo.signImg||t.$store.commit("user/SET_USERINFO_SIGNIMG",t.signImg)),1==t.isDefault&&t.$store.commit("user/SET_USERINFO_SIGNIMG",t.signImg),t.signVisible=!1,t.loading=!1,t.$emit("close",t.signImg),t.handleReset()})).catch((function(e){t.signVisible=!1,t.loading=!1,t.$emit("close"),t.handleReset()}))})).catch((function(e){t.loading=!1,t.$message.warning("请签名")}))}}},h=r,c=(s("62cc"),s("2877")),l=Object(c["a"])(h,i,n,!1,null,"229309b6",null);e["default"]=l.exports},f12b:function(t,e,s){}}]);
//# sourceMappingURL=index.umd.min.22.js.map